<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>정리본 팝업 - 카테고리별 문제점 표시</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    #map { height: 100vh; }

    .popup-wrapper { width: 280px; padding: 12px; }
    .popup-title { font-size: 20px; font-weight: bold; margin-bottom: 6px; }
    .popup-desc { font-size: 14px; color: #555; margin-bottom: 12px; }

    .popup-btn {
        width: 100%; padding: 10px; border: none;
        border-radius: 12px; color:white; font-size:16px;
        background:#7d48ff; cursor:pointer; margin-bottom:8px;
    }

    .popup-container {
        width: 320px;
        max-height: 380px;
        overflow-y: auto;
        padding: 10px;
    }

    .popup-section {
        margin-bottom: 12px;
    }

    .section-title {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 6px;
        color: #333;
    }

    .issue-item {
        background: #fff;
        border: 1px solid #e6e6e6;
        border-radius: 10px;
        padding: 8px 10px;
        margin-bottom: 6px;
        font-size: 13px;
        color: #444;
        line-height: 1.3;
    }

    /* 현황 카드 스타일 (기존 itemsA) */
    .popup-card {
        border:1px solid #ddd; border-radius:12px;
        padding:10px; margin-bottom:12px;
        background:white;
    }

    .popup-card h4 {
        margin:0;
        font-size:17px;
        font-weight:bold;
    }

    .popup-card p {
        margin:6px 0 0;
        font-size:14px;
        color:#555;
        white-space:normal;
        word-break:break-word;
    }
</style>
</head>

<body>
<div id="map"></div>

<script>
// ================================
// 지도
// ================================
const map = L.map("map").setView([37.2450, 127.0790], 16);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19
}).addTo(map);


// ================================
// 첫 번째 팝업 (현황 / 문제점 버튼)
// ================================
function popup1HTML(b) {
    return `
        <div class="popup-wrapper">
            <div class="popup-title">${b.title}</div>
            <div class="popup-desc">${b.desc}</div>

            <button class="popup-btn" onclick="openDetailPopup('${b.id}', 'A')">
                현황
            </button>

            ${b.itemsB ? `
                <button class="popup-btn" style="background:#444;"
                    onclick="openDetailPopup('${b.id}', 'B')">
                    문제점
                </button>
            ` : ``}
        </div>
    `;
}


// ================================
// 현황 팝업 (문제점 팝업과 동일한 형식)
// ================================
function popupDetailA(b) {
    const catLabels = {
        studying: "공부공간 현황",
        rest: "휴식공간 현황",
        etc: "추가정보"
    };

    let html = `<div class="popup-container">`;

    ["studying","rest","etc"].forEach(cat => {
        const arr = b.itemsA && b.itemsA[cat] ? b.itemsA[cat] : [];
        if (arr.length > 0) {
            html += `
                <div class="popup-section">
                    <div class="section-title">${catLabels[cat]}</div>
            `;
            arr.forEach(text => {
                html += `<div class="issue-item">${text}</div>`;
            });
            html += `</div>`;
        }
    });

    const hasAny = b.itemsA && (
        (b.itemsA.studying && b.itemsA.studying.length) ||
        (b.itemsA.rest && b.itemsA.rest.length) ||
        (b.itemsA.etc && b.itemsA.etc.length)
    );

    if (!hasAny) {
        html += `
            <div class="popup-section">
                <div class="section-title">현황</div>
                <div class="issue-item">현황 정보가 없습니다.</div>
            </div>
        `;
    }

    html += `</div>`;
    return html;
}



// ================================
// 문제점 팝업 (카테고리별: 공부공간 / 휴식공간 / 공간 노후화)
// ================================
function popupDetailB(b) {
    const catLabels = {
        studying: "공부공간 문제",
        rest: "휴식공간 문제",
        aging: "공간 노후화 문제"
    };

    let html = `<div class="popup-container">`;

    // iterate categories in desired order
    ["studying","rest","aging"].forEach(cat => {
        const arr = b.itemsB && b.itemsB[cat] ? b.itemsB[cat] : [];
        if (arr.length > 0) {
            html += `<div class="popup-section"><div class="section-title">${catLabels[cat]}</div>`;
            arr.forEach(it => {
                html += `<div class="issue-item">${it}</div>`;
            });
            html += `</div>`;
        }
    });

    // if no items found
    const hasAny = b.itemsB && ( (b.itemsB.studying && b.itemsB.studying.length) ||
                                 (b.itemsB.rest && b.itemsB.rest.length) ||
                                 (b.itemsB.aging && b.itemsB.aging.length) );
    if (!hasAny) {
        html += `<div class="popup-section"><div class="section-title">문제점</div><div class="issue-item">문제점 정보가 없습니다.</div></div>`;
    }

    html += `</div>`;
    return html;
}


// ================================
// 건물 데이터 (itemsB는 카테고리별 배열)
// ================================
const buildings = [
    {
        id: "b1",
        lat: 37.246271,
        lng: 127.080850,
        title: "공과대학",
        desc: "경희대학교 공과대학관은 다양한 공학 계열 학과들이 위치한 중심 교육·연구 건물입니다.",
        itemsA: {
            studying: [
                "개인공부가 가능한 독서실 형태의 공대 열람실",
                "회의 및 팀플이 가능한 공대편의점",
		"개인공부및 자료습득에 용이한 공학도서관"
            ],
            rest: [
                "학생들이 휴식할 수 있는 학생 휴게실",
		"2층 잡카페"
            ],
            etc: [	
		"여자 휴게실만 존재하고 남자 휴게실은 존재하지 않음",
		"여자 휴게실 내부에는 침구류와 편의도구가 비치되어 있어 누워서 쉴 수 있음",
		"잡카페는 이름만 카페고 실제로는 취식이 불가한 장소임"
			]
        },
        itemsB: {
            studying: [
                "공대 열람실 내 악취 발생 (환기 필요)",
                "열람실 대부분 좌석에 콘센트 부족",
                "전공 프로그램 실행에 필요한 컴퓨터가 비치된 강의실 사용 가능 시간의 파악이 어려움."
            ],
            rest: [
                "공대는 남자 비율이 높음에도 불구하고 남자 휴게실이 존재하지 않음",
                "그나마 휴식할 수 있는 공간인 공편은 수업이 마치는 시간이 되면 사람이 붐벼 사용이 어려움",
                "야외 벤치는 비흡연자는 담배 연기 때문에 사용에 어려움을 겪음"
            ],
            aging: [
                "강의실 바닥 긁힘, 칠 벗겨짐, 창틀 변색",
                "건물 외벽 전반의 노후화",
                "강의실 좌석 및 내부 마감재 교체 필요"
            ]
        }
    },

    {
        id: "b2",
        lat: 37.242839,
        lng: 127.081253,
        title: "생명과학대학",
        desc: "생명과학·생명공학 관련 교육 및 연구 공간.",
        itemsA: {
            studying: [
                "팀플 및 소규모 연구활동이 가능한 오픈랩",
                "개인 공부가 가능한 1층 열람실"
            ],
            rest: [
                "야외에 음식 배달 및 취식이 가능한 테이블",
                "1층 로비의 다수의 소파"
            ],
            etc: [
		"오픈랩은 생명과학대학생만 이용가능함",
		"열람실은 타과학생도 이용가능함"
	]
        }
    },

    {
        id: "b3",
        lat: 37.240829,
        lng: 127.079566,
        title: "중앙도서관",
        desc: "학술자료 및 열람실을 갖춘 대표 학습 공간.",
        itemsA: {
            studying: [
                "개인 공부를 위한 1,2열람실",
                "회의 및 팀플이 가능한 그룹스터디룸",
                "대화하면서 공부할 수 있는 공간인 벗터"
            ],
            rest: [
                "벗터내에 다양한 휴게 시설이 존재",
                "음식 배달 및 취식이 가능한 2층 휴게실",
                "1층 로비의 기둥 옆에 있는 벤치"
            ],
            etc: [
                "벗터는 대화가 가능한 공간이지만 실제로는 조용히 공부만 하는 공간으로 사용되고 있음"
            ]
        },
        itemsB: {
            studying: [
                "시험기간에는 그룹 스터디룸을 거의 이용할 수 없을정도로 경쟁이 심함",
                "시험기간에 도서관 자리가 없는 경우가 빈번함"
            ],
            rest: [
                "대화·휴식 가능한 공간 추가 필요",
                "로비의 의자는 등받이가 없어 휴식공간으로서 부적합함"
            ],
            aging: [
                "2열람실의 스터디룸의 방음부스중 일부는 손상정도가 심하여 방음기능을 완벽히 수행하지 못함"
            ]
        }
    },

    {
        id: "b4",
        lat: 37.244331,
        lng: 127.076777,
        title: "멀티미디어 교육관",
        desc: "대형 강의가 진행되는 교육 시설.",
        itemsA: {
            studying: [
                "공부가능한 1층 라운지"
            ],
            rest: [
                "소파와 같은 휴식공간이 있는 로비"
            ],
            etc: []
        },
        itemsB: {
            studying: [
                "일부 강의실의 책상/의자 상태 불량"
            ],
            rest: [
                "휴식공간이 있으나 양이 부족해 대체 휴게공간 필요"
            ],
            aging: [
                "강의실 및 내부 마감재의 노후화",
                "냉난방 장치의 불균형 (일부 교실 온도 문제)"
            ]
        }
    },

    {
        id: "b5",
        lat: 37.245024,
        lng: 127.077123,
        title: "외국어 대학관",
        desc: "어문계열 교육 공간.",
        itemsA: {
            studying: [
                "개인 공부가 가능한 외대 열람실",
                "팀플가능한 1층 라운지",
		"팀플 가능한 3층 오픈랩"
            ],
            rest: [
                "3층에 있는 남자 휴게실",
                "2층에 있는 여자 휴게실"
            ],
            etc: [
                "휴게실 내부에는 누워서 쉴 수 있는 간이 침대가 존재했음",
                "침대 3개중 1개는 노후화로 인해 사용할 수 없었음",
                "1층 라운지는 카페가 문 닫을 때 같이 문닫음."
            ]
        }
    },

    {
        id: "b6",
        lat: 37.244298,
        lng: 127.080382,
        title: "체육 대학관",
        desc: "체육계열의 교육 및 실습 공간.",
        itemsA: {
            studying: [
                "개인 공부가 가능한 체대 독서실",
                "운동연습을 할 수 있는 연습실"
            ],
            rest: [
                "학생들이 쉴 수 있는 학생 휴게실",
                "교직원들이 쉴 수 있는 교직원 휴게실"
            ],
            etc: []
        }
    },

    {
        id: "b7",
        lat: 37.239508,
        lng: 127.083496,
        title: "전자정보 대학관",
        desc: "전자·정보 분야 교육 공간.",
        itemsA: {
            studying: [
                "개인 공부가 가능한 전정대 열람실(오픈랩)",
                "팀플및 회의 가능한 2층 라운지"
            ],
            rest: [
                "휴식 및 공부가능한 3층 이노갤러리"
            ],
            etc: ["전정대 열람실은 타과 학생들도 사용가능함"]
        }
    },

    {
        id: "b8",
        lat: 37.241570,
        lng: 127.084678,
        title: "예술디자인 대학관",
        desc: "예술·디자인 학생을 위한 교육·작업 공간.",
        itemsA: {
            studying: [
                "1층 카페 및 라운지에서 팀플 가능함."
            ],
            rest: [
                "소파및 의자가 존재하는 로비",
                "엘레베이터 사이의 휴식공간"
            ],
            etc: [
                "휴식공간은 층마다 존재했음",
		"공부할 수 있는 공간보다는 실습을 위한 공간이 많았음"
            ]
        }
    }
];


// ================================
// 마커 생성
// ================================
const markers = {};
buildings.forEach(b => {
    const marker = L.marker([b.lat, b.lng]).addTo(map);
    marker.bindPopup(popup1HTML(b), { maxWidth: 400 });
    markers[b.id] = marker;
});


// ================================
// 팝업 열기: A 현황 / B 문제점
// ================================
window.openDetailPopup = function(id, mode) {
    const b = buildings.find(x => x.id === id);
    const marker = markers[id];

    marker.closePopup();

    setTimeout(() => {
        const content = (mode === 'A') ? popupDetailA(b) : popupDetailB(b);
        L.popup({ maxWidth: 400 })
            .setLatLng(marker.getLatLng())
            .setContent(content)
            .openOn(map);
    }, 20);
};
</script>

</body>
</html>




