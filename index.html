<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>정리본 팝업 - 카테고리별 문제점 표시</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    #map { height: 100vh; }

    .popup-wrapper { width: 280px; padding: 12px; }
    .popup-title { font-size: 20px; font-weight: bold; margin-bottom: 6px; }
    .popup-desc { font-size: 14px; color: #555; margin-bottom: 12px; }

    .popup-btn {
        width: 100%; padding: 10px; border: none;
        border-radius: 12px; color:white; font-size:16px;
        background:#7d48ff; cursor:pointer; margin-bottom:8px;
    }

    .popup-container {
        width: 320px;
        max-height: 380px;
        overflow-y: auto;
        padding: 10px;
    }

    .popup-section {
        margin-bottom: 12px;
    }

    .section-title {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 6px;
        color: #333;
    }

    .issue-item {
        background: #fff;
        border: 1px solid #e6e6e6;
        border-radius: 10px;
        padding: 8px 10px;
        margin-bottom: 6px;
        font-size: 13px;
        color: #444;
        line-height: 1.3;
    }

    /* 현황 카드 스타일 (기존 itemsA) */
    .popup-card {
        border:1px solid #ddd; border-radius:12px;
        padding:10px; margin-bottom:12px;
        background:white;
    }

    .popup-card h4 {
        margin:0;
        font-size:17px;
        font-weight:bold;
    }

    .popup-card p {
        margin:6px 0 0;
        font-size:14px;
        color:#555;
        white-space:normal;
        word-break:break-word;
    }
</style>
</head>

<body>
<div id="map"></div>

<script>
// ================================
// 지도
// ================================
const map = L.map("map").setView([37.2450, 127.0790], 16);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19
}).addTo(map);


// ================================
// 첫 번째 팝업 (현황 / 문제점 버튼)
// ================================
function popup1HTML(b) {
    return `
        <div class="popup-wrapper">
            <div class="popup-title">${b.title}</div>
            <div class="popup-desc">${b.desc}</div>

            <button class="popup-btn" onclick="openDetailPopup('${b.id}', 'A')">
                현황
            </button>

            ${b.itemsB ? `
                <button class="popup-btn" style="background:#444;"
                    onclick="openDetailPopup('${b.id}', 'B')">
                    문제점
                </button>
            ` : ``}
        </div>
    `;
}


// ================================
// 현황 팝업 (itemsA)
// ================================
function popupDetailA(b) {
    let html = `<div class="popup-container">`;

    if (b.itemsA && b.itemsA.length) {
        b.itemsA.forEach(item => {
            html += `
                <div class="popup-card">
                    <h4>${item.name}</h4>
                    <p>${item.desc}</p>
                </div>
            `;
        });
    } else {
        html += `<div class="popup-card"><p>현황 정보가 없습니다.</p></div>`;
    }

    html += `</div>`;
    return html;
}


// ================================
// 문제점 팝업 (카테고리별: 공부공간 / 휴식공간 / 공간 노후화)
// ================================
function popupDetailB(b) {
    const catLabels = {
        studying: "공부공간 문제",
        rest: "휴식공간 문제",
        aging: "공간 노후화 문제"
    };

    let html = `<div class="popup-container">`;

    // iterate categories in desired order
    ["studying","rest","aging"].forEach(cat => {
        const arr = b.itemsB && b.itemsB[cat] ? b.itemsB[cat] : [];
        if (arr.length > 0) {
            html += `<div class="popup-section"><div class="section-title">${catLabels[cat]}</div>`;
            arr.forEach(it => {
                html += `<div class="issue-item">${it}</div>`;
            });
            html += `</div>`;
        }
    });

    // if no items found
    const hasAny = b.itemsB && ( (b.itemsB.studying && b.itemsB.studying.length) ||
                                 (b.itemsB.rest && b.itemsB.rest.length) ||
                                 (b.itemsB.aging && b.itemsB.aging.length) );
    if (!hasAny) {
        html += `<div class="popup-section"><div class="section-title">문제점</div><div class="issue-item">문제점 정보가 없습니다.</div></div>`;
    }

    html += `</div>`;
    return html;
}


// ================================
// 건물 데이터 (itemsB는 카테고리별 배열)
// ================================
const buildings = [
    {
        id: "b1",
        lat: 37.246271,
        lng: 127.080850,
        title: "공과대학",
        desc: "경희대학교 공과대학관은 다양한 공학 계열 학과들이 위치한 중심 교육·연구 건물입니다.",
        itemsA: [
            { name:"공부공간", desc:"공대 열람실 및 팀플 룸 존재" },
            { name:"휴식공간", desc:"여자 휴게실 존재" },
        ],
        itemsB: {
            studying: [
                "공대 열람실 내 악취 발생 (환기 필요)",
                "열람실 대부분 좌석에 콘센트 부족",
                "전공 프로그램 실행에 필요한 컴퓨터가 비치된 강의실 사용 가능 시간의 파악이 어려움."
            ],
            rest: [
                "공대는 남자 비율이 높음에도 불구하고 남자 휴게실이 존재하지 않음",
                "그나마 휴식할 수 있는 공간인 공편은 수업이 마치는 시간이 되면 사람이 붐벼 사용이 어려움",
		"야외 벤치는 비흡연자는 담배 연기 때문에 사용에 어려움을 겪음"	
            ],
            aging: [
                "강의실 바닥 긁힘, 칠 벗겨짐, 창틀 변색",
                "건물 외벽 전반의 노후화",
                "강의실 좌석 및 내부 마감재 교체 필요"
            ]
        }
    },

    {
        id: "b2",
        lat: 37.242839,
        lng: 127.081253,
        title: "생명과학대학",
        desc: "생명과학·생명공학 관련 교육 및 연구 공간.",
        itemsA: [
            { name:"지하 1층 공부공간", desc:"지하 1층에 공부공간 존재" },
            { name:"휴식공간", desc:"1층 로비 쉼터 존재" },
        ]
        // itemsB 없음 -> 문제점 버튼 표시 안됨
    },

    {
        id: "b3",
        lat: 37.240829,
        lng: 127.079566,
        title: "중앙도서관",
        desc: "학술자료 및 열람실을 갖춘 대표 학습 공간.",
        itemsA: [
            { name:"공부공간", desc:"팀플을 위한 그룹스터디룸이 존재/개인 공부를 위한 열람실 존재" },
            { name:"휴식공간", desc:"음식 배달및 취식이 가능한 2층 휴게실 존재/1층 로비에 벤치 존재" },
        ],
        itemsB: {
            studying: [
                "시험기간에는 그룹 스터디룸을 거의 이용할 수 없을정도로 경쟁이 심함",
                "시험기간에 도서관 자리가 없는 경우가 빈번함"
            ],
            rest: [
                "대화·휴식 가능한 공간 추가 필요",
                "로비의 의자는 등받이가 없어 휴식공간으로서 부적합함"
            ],
            aging: [
                "2열람실의 스터디룸의 방음부스중 일부는 손상정도가 심하여 방음기능을 완벽히 수행하지 못함"
            ]
        }
    },

    {
        id: "b4",
        lat: 37.244331,
        lng: 127.076777,
        title: "멀티미디어 교육관",
        desc: "대형 강의가 진행되는 교육 시설.",
        itemsA: [
            { name:"공부공간", desc:"1층 라운지에서 공부 가능" },
            { name:"휴식공간", desc:"로비 소파 및 휴식공간 존재" },
        ],
        itemsB: {
            studying: [
                "일부 강의실의 책상/의자 상태 불량",
            ],
            rest: [
                "휴식공간이 있으나 양이 부족해 대체 휴게공간 필요"
            ],
            aging: [
                "강의실 및 내부 마감재의 노후화",
                "냉난방 장치의 불균형 (일부 교실 온도 문제)"
            ]
        }
    },

    {
        id: "b5",
        lat: 37.245024,
        lng: 127.077123,
        title: "외국어 대학관",
        desc: "어문계열 교육 공간.",
        itemsA: [
            { name:"공부공간", desc:"지하1층 열람실 / 1층 카페에서 팀플 가능" },
            { name:"휴식공간", desc:"남녀 휴게실(2층/3층) 존재" },
        ]
    },

    {
        id: "b6",
        lat: 37.244298,
        lng: 127.080382,
        title: "체육 대학관",
        desc: "체육계열의 교육 및 실습 공간.",
        itemsA: [
            { name:"공부공간", desc:"지하 독서실 및 연습실 존재" },
            { name:"휴식공간", desc:"학생 및 교직원 휴게실 존재" },
        ]
    },

    {
        id: "b7",
        lat: 37.239508,
        lng: 127.083496,
        title: "전자정보 대학관",
        desc: "전자·정보 분야 교육 공간.",
        itemsA: [
            { name:"공부공간", desc:"전정대 열람실 / 2층 라운지 팀플 가능" },
            { name:"휴식공간", desc:"2층 라운지 / 3층 이노갤러리" },
        ]
    },

    {
        id: "b8",
        lat: 37.241570,
        lng: 127.084678,
        title: "예술디자인 대학관",
        desc: "예술·디자인 학생을 위한 교육·작업 공간.",
        itemsA: [
            { name:"공부공간", desc:"1층 카페에서 팀플 가능" },
            { name:"휴식공간", desc:"로비 소파 및 의자 존재" },
        ]
    },
];


// ================================
// 마커 생성
// ================================
const markers = {};
buildings.forEach(b => {
    const marker = L.marker([b.lat, b.lng]).addTo(map);
    marker.bindPopup(popup1HTML(b), { maxWidth: 400 });
    markers[b.id] = marker;
});


// ================================
// 팝업 열기: A 현황 / B 문제점
// ================================
window.openDetailPopup = function(id, mode) {
    const b = buildings.find(x => x.id === id);
    const marker = markers[id];

    marker.closePopup();

    setTimeout(() => {
        const content = (mode === 'A') ? popupDetailA(b) : popupDetailB(b);
        L.popup({ maxWidth: 400 })
            .setLatLng(marker.getLatLng())
            .setContent(content)
            .openOn(map);
    }, 20);
};
</script>

</body>
</html>

